{% extends "base.html.twig" %}

{% set load_app_js = true %} {# This line prevents app.js from loading #}

{% block title %}Match Simulator{% endblock %}

{% block content %}
<style>
.dzones {
    @media only screen and (max-width: 768px) {
        flex-direction: column;
    }
}
.search-container .search-input {
    width: 2.5rem; /* 40px, just the icon width */
    height: 2.5rem; /* 40px */
    padding-left: 2.5rem;
    border-radius: 9999px;
    cursor: pointer;
    transition: width 0.3s ease-in-out;
}
.search-container.expanded .search-input {
    width: 100%;
    cursor: text;
}
@media (min-width: 768px) {
    .search-container.expanded .search-input {
        width: 16rem; /* 256px */
    }
}
</style>
<div class="container mx-auto px-4 py-8">
    
    <div id="matchSetup" class="bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700 mb-8">
        <div>
            <h1 class="text-4xl font-bold text-center text-yellow-400 mb-2">Match Simulator</h1>
            <p class="text-center text-gray-300 mb-8">
                Click on or drag and drop wrestlers from the roster to add them to the selection area to set up your match.<br>
                You can simulate single matches or tag team matches.
                After selecting wrestlers, click "Simulate Match" to see the results!<br><br>
            </p>
        </div>
        <div class="flex flex-col lg:flex-row justify-center w-full mb-6 gap-4">
            <div class="flex flex-col lg:flex-row justify-between items-center w-full mb-6 gap-4">
                <button id="singleMatchBtn" class="px-6 py-2 font-bold rounded-l-lg bg-yellow-500 text-gray-900">Singles Match</button>
                <button id="tagTeamMatchBtn" class="px-6 py-2 font-bold rounded-r-lg bg-gray-700 hover:bg-gray-600 transition-colors">Tag Team Match</button>

                <button id="randomMatchupBtn" class="px-4 py-2 font-bold rounded-lg bg-indigo-600 hover:bg-indigo-500 transition-colors text-white">Random Matchup</button>
                <button id="resetMatchBtn" class="px-4 py-2 font-bold rounded-lg bg-red-600 hover:bg-red-500 transition-colors text-white">Reset Match</button>
                <button id="helpBtn" class="help-button">?</button>
            </div>
        </div>

        <div id="singleMatchLayout">
            <div class="flex items-center justify-center space-x-8 dzones">
                <div id="player1DropZone" class="w-full lg:w-1/2 h-72 bg-gray-900 border-2 border-dashed border-yellow-300 rounded-lg flex items-center justify-center text-white transition-colors">
                    Drag Wrestler 1 Here
                </div>
                <div class="text-5xl font-bold text-yellow-500 pt-4 pb-4">VS</div>
                <div id="player2DropZone" class="w-full lg:w-1/2 h-72 bg-gray-900 border-2 border-dashed border-yellow-300 rounded-lg flex items-center justify-center text-white transition-colors">
                    Drag Wrestler 2 Here
                </div>
            </div>
        </div>

        <div id="tagTeamMatchLayout" class="hidden">
            <div class="flex items-center justify-center space-x-8 dzones">
                <div class="w-full lg:w-1/2 flex flex-col space-y-4">
                    <h3 class="text-center text-2xl font-bold text-yellow-400">Team 1</h3>
                    <div id="team1_player1DropZone" class="h-60 border-2 border-dashed border-blue-300 rounded-lg flex items-center justify-center text-white transition-colors">
                        Drag Wrestler 1 Here
                    </div>
                    <div id="team1_player2DropZone" class="h-60 border-2 border-dashed border-blue-300 rounded-lg flex items-center justify-center text-white transition-colors">
                        Drag Wrestler 2 Here
                    </div>
                </div>

                <div class="text-5xl font-bold text-yellow-500 pt-4 pb-4">VS</div>

                <div class="w-full lg:w-1/2 flex flex-col space-y-4">
                     <h3 class="text-center text-2xl font-bold text-yellow-400">Team 2</h3>
                    <div id="team2_player1DropZone" class="h-60 border-2 border-dashed border-green-300 rounded-lg flex items-center justify-center text-white transition-colors">
                        Drag Wrestler 1 Here
                    </div>
                    <div id="team2_player2DropZone" class="h-60 border-2 border-dashed border-green-300 rounded-lg flex items-center justify-center text-white transition-colors">
                        Drag Wrestler 2 Here
                    </div>
                </div>
            </div>
        </div>
        <div id="actionButtons" class="text-center mt-6 space-x-4">
            <button id="startMatchBtn" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-500 transition-colors hidden">Simulate Match</button>
            <button id="simulate100xBtn" class="py-3 px-8 font-bold rounded-lg bg-purple-600 hover:bg-purple-500 transition-colors text-white hidden">Simulate 100x</button>
            <button id="calculateOddsBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-500 transition-colors hidden">Calculate Betting Odds</button>
        </div>
    </div>

    <div id="resultsContainer" class="hidden">
        <h2 class="text-3xl font-bold text-center text-yellow-400 mb-4">Match Results</h2>
        <div id="winnerDisplay" class="text-center mb-6"></div>
        <div id="matchLog" class="bg-gray-900 rounded-lg p-4 h-96 overflow-y-auto border border-gray-700"></div>
    </div>

    <div class="mt-12 p-8 bg-gray-900 rounded-lg shadow-lg border border-gray-700" style="background-color: var(--roster-bg);">
        <div class="flex flex-col md:flex-row justify-between md:items-center mb-6 gap-4">
            <h2 class="text-3xl font-bold text-yellow-400 mb-4 md:mb-0">Roster</h2>
            
            <div class="flex flex-col sm:flex-row items-center gap-4 w-full md:w-auto">
                <div id="searchContainer" class="search-container relative flex items-center">
                    <svg class="search-icon absolute left-4 top-4 -translate-y-1/2 h-6 w-6 text-gray-400 z-10 cursor-pointer" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <input type="text" id="searchInput" class="search-input bg-gray-700 text-white" placeholder="Search wrestlers...">
                </div>

                <div class="flex items-center justify-start md:justify-end gap-2 w-full sm:w-auto">
                    <label for="sortSelect" class="text-gray-300">Sort By:</label>
                    <select id="sortSelect" class="bg-gray-700 text-white rounded-md p-2">
                        <option value="name">Name</option>
                        <option value="overall">Overall</option>
                        <option value="strength">Strength</option>
                        <option value="technicalAbility">Technical</option>
                        <option value="brawlingAbility">Brawling</option>
                        <option value="aerialAbility">Aerial</option>
                        <option value="stamina">Stamina</option>
                        <option value="toughness">Toughness</option>
                    </select>
                    <button id="sortOrderBtn" class="p-2 bg-gray-700 text-white rounded-md hover:bg-gray-600">
                        <span id="sortOrderIcon">â†“</span>
                    </button>
                </div>
            </div>
        </div>
        <div id="wrestlerRoster" class="wrestler-roster grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 overflow-y-scroll h-[600px] p-2 rounded-lg" style="position: relative; z-index: 10; pointer-events: auto; overflow-y: scroll; max-height: 800px;">
            <div id="rosterContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-6 bg-gray-800 p-6 rounded-lg" style="border: 0px solid;"></div>
        </div>
    </div>
</div>

<div id="genericModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
    <div class="bg-gray-900 p-8 rounded-lg shadow-2xl w-full max-w-3xl text-white border-2 border-indigo-600">
        <h2 id="modalTitle" class="text-2xl font-bold mb-6 text-yellow-400 text-center">Results</h2>
        <div id="modalBody">
        </div>
        <div class="text-center mt-6">
            <button id="closeModalBtn" class="px-6 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg">Close</button>
        </div>
    </div>
</div>

<div id="helpModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
    <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-2xl text-white border-2 border-indigo-600">
        <h2 id="helpModalTitle" class="text-2xl font-bold mb-6 text-yellow-400 text-center">About the Simulator</h2>
        <div id="helpModalBody" class="text-gray-300 space-y-4">
            <p>
                To calculate betting odds based on the selected wrestlers' and place a bet, click "Calculate Betting Odds".
            </p>
            <p>
                Note that overall rating is calculated using the wrestler's attributes.
                It is a representation of their skill level in all areas combined, 
                but does not take into account other factors such as size and weight or injury status.
                Having a high overall rating doesn't necessarily mean 
                that they are better than someone with a lower overall rating, but a higher overall rating does indicate that they have a wider skill set, 
                and thus more ways to win a match.
            </p>
            <p>
                A wrestler with a lower overall rating may still be able to win if they specialize in one particular aspect of wrestling, i.e. high strength or technical skill ratings.
            </p>
            <p>
                For more information about how the simulator works, check out the documentation below:
            </p>
            <p>
                <a href="{{ base_url }}documentation/simulation-engine" target="_blank" class="underline text-blue-400 hover:text-blue-300">Simulation Engine Documentation</a>
            </p>
        </div>
        <div class="text-center mt-6">
            <button id="closeHelpModalBtn" class="px-6 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg">Close</button>
        </div>
    </div>
</div>

<script>
    // Pass the wrestler data from Twig to our JavaScript file
    const RosterData = {{ wrestlers|json_encode|raw }};
</script>
<script src="{{ base_url }}public/template/default/assets/js/simulator.js" defer></script>
{% endblock %}

